<html>

<head>
  <style>
    @font-face {
      font-family: 'FOT-NewRodin Pro';
      src: url('font/FOT-NewRodin Pro L.otf');
      font-weight: 300;
    }

    @font-face {
      font-family: 'FOT-NewRodin Pro';
      src: url('font/FOT-NewRodin Pro M.otf');
      font-weight: 400;
    }

    @font-face {
      font-family: 'FOT-NewRodin Pro';
      src: url('font/FOT-NewRodin Pro DB.otf');
      font-weight: 600;
    }

    @font-face {
      font-family: 'FOT-NewRodin Pro';
      src: url('font/FOT-NewRodin Pro EB.otf');
      font-weight: 700;
    }

    @font-face {
      font-family: 'FOT-NewRodin Pro';
      src: url('font/FOT-NewRodin Pro UB.otf');
      font-weight: 800;
    }

    #bg {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #000;
      color: #fff;
      font-size: clamp(100px, 20vw, 230px);
      font-family: 'FOT-NewRodin Pro';
      font-weight: bold;
      text-align: center;
      transition: ease background-color 1s;
      flex-direction: column;
      height: 97.5%;
      border: solid #fff 4px;
      border-radius: 6px;

      &.finish {
        background-color: #d00;
      }
    }

    #bar-border {
      width: 85%;
      height: clamp(12px, 4vw, 20px);
      padding: 4px;
      border: solid 4px;
      border-color: inherit;
      border-radius: 6px;
    }

    #bar {
      background-color: #fff;
      width: 100%;
      height: 100%;
      transition: linear width 1s;
    }

    #message {
      font-size: clamp(45px, 5vw, 90px);
      color: inherit;
      cursor: default;
      user-select: none;
    }

    #bg.half {
      color: #ff0;
      border-color: #ff0;

      #bar {
        background-color: #ff0;
      }
    }

    #bg.almost {
      color: #f80;
      border-color: #f80;

      #bar {
        background-color: #f80;
      }
    }

    #bg.over {
      color: #f00;
      border-color: #f00;

      #bar-border {
        border-color: #f00;
      }

      #message {
        animation: blink 0.5s steps(1, start) infinite;
      }
    }

    @keyframes blink {
      50% {
        visibility: hidden;
      }
    }

    .display-inputs {
      display: flex;
      color: inherit;
      margin-bottom: 0.3em;

      #sec-span {
        width: 1.66em;
        height: 1em;
        cursor: default;
        user-select: none;
        line-height: 1;
      }

      #dots {
        width: 0.5em;
        height: 1em;
        cursor: default;
        user-select: none;
        line-height: 1;
      }

      input {
        width: 1.66em;
        height: 1em;
        background: none;
        border: none;
        color: inherit;
        font-family: inherit;
        font-weight: bold;
        font-size: inherit;

        &::-webkit-outer-spin-button,
        &::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }

        &[type="number"] {
          -moz-appearance: textfield;
        }

      }
    }

    #reset-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: inherit;
      visibility: hidden;
      position: absolute;
      bottom: 64px;

      &.visible {
        visibility: visible;
      }
    }

  </style>
</head>

<body id="bg">
  <div class="display-inputs">
    <input id="minInput" type="number" value="" autofocus placeholder="00" min="0" max="59" maxlength="2">
    <span id="dots">:</span>
    <span id="sec-span">00</span>
  </div>
  <div id="bar-border">
    <div id="bar"></div>
  </div>
  <span id="message">&nbsp;</span>
  <button id="reset-btn">
    <svg width="64px" height="64px" fill="currentcolor" inkscape:version="1.2.1 (9c6d41e410, 2022-07-14)" sodipodi:docname="reset-svgrepo-com.svg" version="1.1" viewBox="0 0 1920 1920" xmlns="http://www.w3.org/2000/svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd">
      <sodipodi:namedview bordercolor="#ffffff" borderopacity="1" inkscape:current-layer="svg4" inkscape:cx="-12.587413" inkscape:cy="127.27273" inkscape:deskcolor="#505050" inkscape:pagecheckerboard="1" inkscape:pageopacity="0" inkscape:showpageshadow="0" inkscape:window-height="1009" inkscape:window-maximized="1" inkscape:window-width="1920" inkscape:window-x="-8" inkscape:window-y="-8" inkscape:zoom="1.0725" pagecolor="#505050" showgrid="false" />
      <path d="m960 0v213.33c-411.63 0-746.67 334.93-746.67 746.67s335.04 746.67 746.67 746.67 746.67-334.93 746.67-746.67c0-197.01-78.4-382.51-213.33-520.75v254.08h-213.33v-586.67h586.67v213.33h-191.04c155.73 174.08 244.37 400.96 244.37 640 0 529.28-430.61 960-960 960s-960-430.72-960-960 430.61-960 960-960" fill-rule="evenodd" />
    </svg>
  </button>

  <script>
    const bg = document.querySelector('#bg');
    const minInput = document.querySelector('#minInput');
    const secSpan = document.querySelector('#sec-span');
    const bar = document.querySelector('#bar');
    const message = document.querySelector('#message');
    const resetBtn = document.querySelector('#reset-btn');

    let min = 0;
    let sec = 0;
    let totalSec = 0;

    // garante 2 dígitos no campo
    minInput.addEventListener('keydown', e => {
      if (e.target.value.length > 2) {
        e.target.value = e.target.value.substr(-2, 2);
      } else if (e.target.value.length < 2) {
        e.target.value = e.target.value.toString().padStart(2, '0');
      }
    });

    // dá play quando aperta enter ou espaço
    document.addEventListener('keydown', e => {
      if ((e.keyCode === 13 || e.keyCode === 32) && !minInput.disabled && minInput.value >= 1) {
        min = +document.querySelector('#minInput').value - 1;
        sec = 59;
        totalSec = getTotalSecs();
        timerDecrease();
        minInput.disabled = 'true';
        resetBtn.classList.add('visible');
      }
    });

    // foca no campo ao clicar em qualquer lugar
    document.addEventListener('click', e => {
      minInput.focus();
    });

    // faz botão recarregar a página sem cache
    resetBtn.addEventListener('click', e => {
      window.location.reload(true);
    })

    // retorna o total de segundos
    function getTotalSecs() {
      return sec + (min * 60);
    }

    // retorna número em string de 2 caracteres
    function digits(time) {
      return String(time).padStart(2, '0');
    }

    // faz o marcador funcionar como um temporizador
    function timerDecrease() {
      var intervalDecrease = setInterval(() => {

        minInput.value = digits(min);
        secSpan.innerHTML = digits(sec);

        const currentTotal = getTotalSecs();
        bar.style.width = (100 * (currentTotal - 1) / totalSec) + '%';

        if (currentTotal <= totalSec / 2) {
          if (currentTotal <= 30) {
            message.innerHTML = 'PRA CONCLUIR';
            bg.classList.add('almost');
          } else {
            message.innerHTML = 'METADE';
            bg.classList.add('half');
          }
        }

        sec--;
        if (sec < 0) {
          min--;
          if (min < 0) {
            clearInterval(intervalDecrease);
            timerIncrease();
          } else {
            sec = 59;
          }
        }

      }, 1000);
    }

    // faz o marcador funcionar como um cronômetro
    function timerIncrease() {
      min = 0;
      sec = 1;

      var intervalIncrease = setInterval(() => {

        minInput.value = digits(min);
        secSpan.innerHTML = digits(sec);

        message.innerHTML = 'CONCLUA';
        bg.classList.add('over');

        const currentTotal = getTotalSecs();

        if (bg.classList.contains('finish')) {
          bg.classList.remove('finish')
        }
        if (currentTotal % 30 === 0) {
          bg.classList.add('finish')
        }

        sec++;
        if (sec > 59) {
          min++;
          sec = 0;
        }

      }, 1000);
    }

  </script>
</body>

</html>
